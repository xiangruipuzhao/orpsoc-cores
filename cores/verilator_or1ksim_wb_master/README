         SC_MAIN                                                                              
+---------------------------------+                                                           
|                                 |                                                           
|   test_thread                   |                             | setup_xfer();               
|  +--------------------------+   |                             |                             
|  |                          |   |      +----->   generic_read | safe_ev.notify() +---------+
|  |  or1ksim                 |   |      |                      |                            |
|  |  +-------------------+   |   |      |                      | wait_xfer_finished() <--+  |
|  |  |                   |   |   |      |                                                |  |
|  |  |                   |   |   |      |                                                |  |
|  |  |                   +--------------+                                                |  |
|  |  | or1k_main         |   |   |                                                       |  |
|  |  |                   +-------------------->  generic_write                           |  |
|  |  |                   |   |   |                                                       |  |
|  |  |                   |   |   |                                                       |  |
|  |  +-------------------+   |   |                                                       |  |
|  |                          |   |                                                       |  |
|  +--------------------------+   |                                                       |  |
|                                 |                                                       |  |
|   MASTER                        |                                                       |  |
|  +---------------------------+  |                                                       |  |
|  | SC_THREAD(do_xfer)        |  |                                                       |  |
|  |  while(1) {               |  |                                                       |  |
|  |    wait(safe_ev);  <--------------------------------------------------------------------+
|  |    start_cycle();         |  |                                                       |   
|  |                           |  |                                                       |   
|  |    wait(ack_ev);   <---------------+                                                 |   
|  |                           |  |     |                                                 |   
|  |    xfer_finished();  +---------------------------------------------------------------+   
|  |  }                        |  |     |                                                     
|  |                           |  |     |                                                     
|  | SC_THREAD(do_poll_ack)    |  |     |                                                     
|  |  while(1) {               |  |     |                                                     
|  |   if (wb_ack) {           |  |     |                                                     
|  |    xfer.dat_i = wb_dat_i; |  |     |                                                     
|  |    ack_ev.notify();   +------------+                                                     
|  |   }                       |  |                                                           
|  | }                         |  |                                                           
|  |                           |  |                                                           
|  |                           |  |                                                           
|  +---------------------------+  |                                                           
|                                 |                                                           
+---------------------------------+                                                           
